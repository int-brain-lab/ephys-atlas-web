# IBL ephys atlas web app

## Running locally

### 1. Install requirements

Only tested on Ubuntu 22.04.

Install:

* [svgo](https://github.com/svg/svgo)
* [inkscape](https://inkscape.org/)

### 2. Clone the repository

`git clone https://github.com/int-brain-lab/ephys-atlas-web.git`

### 3. Get the data

You can either obtain the generated data directly, or generate it from the input data.

#### 3.1. Generate the data from input files

Get the following files from Cyrille and put them here:

```
* pqt/brain_regions_for_viz.pqt
* pqt/features_for_viz_lateralised.pqt
* csv/block|choice|reward|stimulus.csv
```

Then, run `python tools/process.py`.

#### 3.2. OR obtain the data directly

These files are generated by the `tools/process.py` script. If you obtain these files and put them at their expected location, you don't have to run `tools/process.py`.

```
* data/slices.json          73M file that is loaded once at initial startup
* data/regions.html         a temporary file used to generate semi-automatically index.html
* js/regions.js             names of the brain regions
* css/region_colors.css     default brain region colors
* json/features_*.json      file name structure: features_<featureset>.json
```

### 3. Run the static HTTP server

Run `./run.sh` (which just calls `python -m http.server` as this is a severless static web application for now).


## Deployment

Apache configuration file, for example `/etc/apache2/sites-available/ephysatlas.conf`:

```
<VirtualHost *:80>
    ServerAdmin admin@internationalbrainlab.org
    ServerName ephysatlas.internationalbrainlab.org
    DocumentRoot /path/to/ephys-atlas-web
    AddOutputFilterByType DEFLATE application/javascript application/json
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
```
